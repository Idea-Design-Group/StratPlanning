function initializeInputs(n){if($(n).find(".dynamic-modal").each(function(){var i=$(this).attr("data-id"),n,t;$("#targetId").length>0&&$("#targetId").remove();n=$(this).children().detach();$("body").append(n);t={id:i};$.each(n[0].attributes,function(n,i){t[i.nodeName]=i.nodeValue});n.replaceWith(function(){return $("<form />",t).append(n.contents())})}),$(n).find(".m-select2").select2(),$(n).find(".tag-select").select2({tags:!0,tokenSeparators:[","]}),$(n).find(".datepicker").datepicker({format:"dd-mm-yyyy"}),$(n).find(".select2-without-search").select2({minimumResultsForSearch:Infinity}),$(n).find(".evalution-slider").each(function(n,t){noUiSlider.create(t,{start:[5],step:1,range:{min:[1],max:[10]},tooltips:!0,format:wNumb({decimals:0}),connect:[!0,!1]});t.noUiSlider.on("change.one",function(n){$(this.target).parent().find("input").val(n)});var i=$(t).next('input[type="hidden"]').val();i?t.noUiSlider.set(i):(t.noUiSlider.set(5),$(t).next('input[type="hidden"]').val(5))}),typeof fieldOptions!="undefined"){$(n).find(".m-values-autocomplete").autocomplete({minLength:0,source:fieldOptions.valuesDictionary}).on("click",function(){$(this).autocomplete("search",$(this).val())});$(n).find(".m-stakeholders-autocomplete").autocomplete({minLength:0,source:fieldOptions.stakeholderUsers,change:function(n,t){if(!t.item){$(this).val("");return}$(n.target).next("[data-name='stakeholderId']").val(t.item.id)}}).on("click",function(){$(this).autocomplete("search",$(this).val())}).on("keyup keydown",function(n){n.which==13&&n.preventDefault()})}$.validator.unobtrusive.parse(n);$(n).find(".sp-tooltip").tooltip();$(n).find(".m-scrollable").each(function(n,t){mApp.initScroller($(t),{})});$(n).find(".text-editor").summernote()}function deleteConfirm(){return swal({icon:"warning",title:"Are you sure?",buttons:{confirm:{text:"Yes",value:!0,visible:!0,className:"btn btn-sp m-btn",closeModal:!0},cancel:{text:"No",value:!1,visible:!0,className:"btn btn-secondary m-btn",closeModal:!0}}})}function submitConfirm(n){return swal({icon:"warning",title:"Are you sure?",text:n,buttons:{confirm:{text:"Yes",value:!0,visible:!0,className:"btn btn-sp m-btn",closeModal:!0},cancel:{text:"No",value:!1,visible:!0,className:"btn btn-secondary m-btn",closeModal:!0}}})}function notify(n,t,i=5){$.notify({message:n},{type:t,delay:i*1e3,placement:{from:"bottom",align:"right"},offset:{x:20,y:100},z_index:5e3})}function initializeStep(){function n(n){let t=$(n).parent();return t.find(".dz-message").hide(),deleteConfirm().then(function(i){return i&&n.remove(),t.find(".dz-preview").length==0&&t.find(".dz-message").show(),i})}$(".stakeholders-rating-table .m-select2").select2({minimumResultsForSearch:Infinity});$(".sp-tooltip").tooltip();$("#issues-master-list-table").dataTable({paging:!1,serverSide:!1,searching:!1,info:!1,ordering:!0,columnDefs:[{visible:!1,targets:[0]},{orderable:!1,targets:[1,2,3,4,5]},{orderDataType:"dom-input",targets:[6]}]});$("#issues-master-list-table tr td:nth-child(6) input").blur(function(){$("#issues-master-list-table").DataTable().column(6).order("desc").draw()}).on("keyup",function(n){n.keyCode==13&&$("#issues-master-list-table").DataTable().column(6).order("desc").draw()});$("#issues-master-list-table").on("row-reordered.dt",function(n,t){t.map(function(n){$(n.node).find("input.order").val(n.newPosition)})});$("select.select-specify").on("change",function(){let t=$(this).val(),n=$(this).parent().find("input.select-specify-input");t.toLowerCase()=="-1"?n.show():n.hide()}).trigger("change");$(".dropzone-sp").each(function(){var t=$(this),i=t.data("initurl"),r=t.data("inputname");t.dropzone({init:function(){(thisDropzone=this,i)&&$.get(i,function(n){n!==null&&$.each(n,function(n,t){var i={name:t.name,fileId:t.id};thisDropzone.emit("addedfile",i);$(i.previewElement).find(".sp-file-input").val(t.id);$(i.previewElement).find(".sp-file-link").attr("href",t.url)})})},addRemoveLinks:!0,removedfile:function(t){let i=$(t.previewElement),r=$(i).find(".sp-file-input").val();n(i).then(function(n){n&&(!r||$.ajax({url:"/Worksheet/DeleteFile",method:"post",data:{id:r},success:function(n,t,i){i.status==201;(i.status==202||i.status==400)&&notify("Input data are not valid ","danger",5)},error:function(){notify("An Error occured on the request","danger",5)}}))})},url:"/Worksheet/UploadFile",uploadMultiple:!0,paramName:"file",success:function(n,t){var r=0,i=t.filter(function(t,i){return t.name===n.name?(r=i,!0):!1})[0];$(n.previewElement).find(".sp-file-input").val(i.id);$(n.previewElement).find(".sp-file-link").attr("href",i.url)},error:function(n,t){$(n.previewElement).find(".dz-image").addClass("error-file");$(n.previewElement).find(".dz-error-message").show();typeof t.message!="undefined"?$(n.previewElement).find(".dz-error-message > span").html(t.message):$(n.previewElement).find(".dz-error-message > span").html("An error occured on a server");$(n.previewElement).find(".sp-file-input").remove()},previewTemplate:`
                <div class="dz-preview dz-file-preview dz-processing dz-error dz-complete">
                    <input class="sp-file-input" type="hidden" name="${r}"/>
                    <div class="dz-image"></div>  
                    <div class="dz-details">
                        <div class="dz-filename">
                            <a class="sp-file-link" href="#" target="_Blank"><span data-dz-name=""></span></a>
                        </div>
                    </div>  
                    <div class="dz-progress">
                        <span class="dz-upload" data-dz-uploadprogress=""></span>
                    </div>
                    <div class="dz-error-message" style="display:none">
                        <span class="dz-upload" data-dz-errormessage=""></span>
                    </div>
                    </div>
                    <a class="dz-remove" href="javascript:undefined;" data-dz-remove="">Remove file</a>
                </div>`}).addClass("dropzone")});$(document).on("click",".list-item-delete",function(){let n=$(this).closest(".list-item");n.remove()});$(document).on("click",".list-add-button",function(n){n.preventDefault();let i=$(this).data("input-name"),t=$(this).parents(".list-items-add-group").first().find(".list-add-input").val(),r=$(this).parents(".list-items-add-group").first().find(".list-items").find(".list-item").has(`input[name="${i}"][value="${t}"]`);if(!!t){let n=`<a class="m-list-badge__item m-list-badge__item--default list-item">
                            <input type="hidden" name="${i}" value="${t}"/>
                            ${t}
                            <span class="list-item-delete fa fa-close"></span>
                        </a>`;$(this).parents(".list-items-add-group").first().find(".list-items").append(n);$(this).parents(".list-items-add-group").first().find(".list-add-input").val("")}});$(document).on("keyup",".list-add-input",function(n){n.which==13&&(n.preventDefault(),$(this).parents(".list-items-add-group").first().find(".list-add-button").click())})}function updatePlanningTeam(){$.ajax({url:GetPlanningTeamURL,method:"post",data:{planId:GlobalPlanId},success:function(n,t,i){i.status==400&&notify("Planning team update failed","danger",5);i.status>500&&notify("An error occured on the server","danger",5);$("#planning_team_portlet").html(n);$("#planning_team_portlet").find(".m-select2").select2();$.validator.unobtrusive.parse("#planning_team_portlet form")},error:function(){notify("An Error occured during updating the planning plan's view","danger",5)}})}function updateStep(n){mApp.block("#step_form",{overlayColor:"#000000",type:"loader",state:"success",centerY:!0,centerX:!0});let t=new FormData(document.querySelector("form#step_form"));t.append("IsSubmitted",n);$.ajax({url:SaveStepURL,method:"post",data:t,processData:!1,contentType:!1,success:function(n,t,i){i.status==200&&notify("Successfully saved","success",5);(i.status==202||i.status==400)&&notify("Input data are not valid ","danger",5);$("#step_form_container").html(n);initializeInputs("#step_form_container");initializeStep();mApp.unblock("#step_form")},error:function(){notify("An Error occured on the request","danger",5);mApp.unblock("#step_form")}})}function editRecord(n,t){var u,r,f;if(fieldOptions[t]!==undefined){var e=fieldOptions[t],i=$(n),o=$(t);(!i.is("form")||i.valid())&&(u={},i.find(".m-input").each(function(n,t){u[$(t).attr("data-name")]=$(t).val()}),i.find("select.m-input").each(function(n,t){u[$(t).attr("data-name")+"_label"]=$(t).find("option:selected").text()}),r=i.find(".m-index").val(),r?$("#"+r).replaceWith(e.template(u,r)):(r=guid(),f=e.template(u,r),f&&o.append(f)),i.hasClass("modal")&&i.modal("hide"),i.find(".m-input").each(function(n,t){$(t).val("")}),i.find(".m-index").val(""))}}function selectAnswer(n,t){if(fieldOptions[t]!==undefined){var r=fieldOptions[t],u=$(t),f=JSON.parse($(n).attr("data-val")),e=guid(),i=r.template(f,e);i&&u.append(i)}}function showRecordDetail(n,t){var i=$(t),r=n.closest("tr"),u=JSON.parse($(r).attr("data-val")),f=$(r).attr("id");i.find(".m-input").each(function(n,t){$(t).val(u[$(t).attr("data-name")])});i.find("select.m-select2.m-input[multiple]").each(function(n,t){$(t).val(u[$(t).attr("data-name")].split(","));$(t).trigger("change")});i.find(".m-index").val(f);i.modal("show")}function deleteRecord(n,t=false){var i=n;t!==!1&&(i=n.closest(t));$(i).remove()}function checkLikeRadio(n){$(n).is(":checked")&&$('.radio-checkbox[data-group="'+$(n).attr("data-group")+'"]').each(function(){this!==n&&$(this).prop("checked",!1)})}function guid(){function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}function completeStep(n,t,i){submitConfirm("You won't be able to change it after").then(function(r){if(r)return $.ajax({url:CompleteStepTaskURL,method:"post",data:{planId:n,stepIndex:t},processData:!0,success:function(n,t,r){r.status==200&&(notify("Successfully completed","success",5),i());r.status==202&&notify("The step can not be completed","danger",5)},error:function(){notify("An Error occured on the request","danger",5)}})})}function refreshStepForm(n=false){let t=new FormData(document.querySelector("form#step_form"));t.append("keepFilled",n);$.ajax({url:RefreshStepFormURL,method:"post",data:t,processData:!1,contentType:!1,success:function(n,t,i){i.status==200;i.status>=400&&notify("Step was not refreshed","danger",5);$("#step_form_container").html(n);initializeInputs("#step_form_container");initializeStep()},error:function(){notify("An Error occured on the request","danger",5)}})}$(document).ready(function(){$(".nav-toggle").click(function(){var t=$(this).attr("href"),n=$(this);$(t).toggle(function(){$(this).css("display")=="none"?n.html("Read More"):n.html("Read Less")})})});$(document).ready(function(){initializeInputs(document);$.fn.dataTable.ext.order["dom-select"]=function(n,t){return this.api().column(t,{order:"index"}).nodes().map(function(n){return $("select",n).val()})};$.fn.dataTable.ext.order["dom-input"]=function(n,t){return this.api().column(t,{order:"index"}).nodes().map(function(n){return $("input",n).val()})};$(".user-submit-btn").click(submitConfirm);$(".draggable-file").draggable({revert:"invalid",containment:"document",helper:"clone",cursor:"move"});$(".table-row-delete").click(function(n){n.preventDefault();deleteConfirm()})});$(document).on("submit","form#add_plan_form",function(n){if(n.preventDefault(),$("#add_plan_form").valid()){let t=new FormData(document.querySelector("form#add_plan_form"));$.ajax({url:CreatePlanURL,method:"post",data:t,processData:!1,contentType:!1,success:function(n,t,i){i.status==201&&(notify("Successfully created","success",5),setTimeout(function(){document.location.reload(!1)},2e3));(i.status==202||i.status==400)&&notify("Input data are not valid ","danger",5);$("#add_plan_form").html(n);initializeInputs("#add_plan_form")},error:function(){notify("An Error occured on the request","danger",5)}})}});$(document).on("click",".delete-plan",function(n){n.preventDefault();let t=$(this).data("id");deleteConfirm().then(n=>{n&&$.ajax({url:DeletePlanURL,method:"post",data:{planId:t},success:function(n,t,i){i.status==400&&notify("An Error occured during sending a request","danger",5);n.result?(notify("Successfully deleted","success",5),setTimeout(function(){document.location.reload(!1)},2e3)):notify("Deleting the plan is not possible due to existing answers","danger",5)},error:function(){notify("An Error occured during sending a request","danger",5)}})})});$(document).on("submit","form#add_dictionary_form",function(n){if(n.preventDefault(),$("#add_dictionary_form").valid()){let t=new FormData(document.querySelector("form#add_dictionary_form"));$.ajax({url:CreateDictionaryURL,method:"post",data:t,processData:!1,contentType:!1,success:function(n,t,i){i.status==201&&(notify("Successfully created","success",5),setTimeout(function(){document.location.reload(!1)},2e3));(i.status==202||i.status==400)&&notify("Input data are not valid ","danger",5);$("#add_dictionary_form").html(n);initializeInputs("#add_dictionary_form")},error:function(){notify("An Error occured on the request","danger",5)}})}});$(document).on("click",".delete-dictionary",function(n){n.preventDefault();let t=$(this).data("id");deleteConfirm().then(n=>{n&&$.ajax({url:DeleteDictionaryURL,method:"post",data:{id:t},success:function(n,t,i){i.status==400&&notify("An Error occured during sending a request","danger",5);n.result?(notify("Successfully deleted","success",5),setTimeout(function(){document.location.reload(!1)},2e3)):notify("Deleting the record is not possible ","danger",5)},error:function(){notify("An Error occured during sending a request","danger",5)}})})});$(document).on("click",".activate-dictionary",function(n){n.preventDefault();let t=$(this).data("id");deleteConfirm().then(n=>{n&&$.ajax({url:ActivateDictionaryURL,method:"post",data:{id:t},success:function(n,t,i){i.status==400&&notify("An Error occured during sending a request","danger",5);n.result?(notify("Successfully activated","success",5),setTimeout(function(){document.location.reload(!1)},2e3)):notify("Activating the record is not possible ","danger",5)},error:function(){notify("An Error occured during sending a request","danger",5)}})})});$(document).on("click",".disactivate-dictionary",function(n){n.preventDefault();let t=$(this).data("id");deleteConfirm().then(n=>{n&&$.ajax({url:DisactivateDictionaryURL,method:"post",data:{id:t},success:function(n,t,i){i.status==400&&notify("An Error occured during sending a request","danger",5);n.result?(notify("Successfully Diactivated","success",5),setTimeout(function(){document.location.reload(!1)},2e3)):notify("Disactivating the record is not possible ","danger",5)},error:function(){notify("An Error occured during sending a request","danger",5)}})})});$(document).on("click",".edit-setting",function(n){n.preventDefault();let t=$(this).data("index");$.ajax({url:UpdateSettingURL,method:"get",data:{index:t},success:function(n,t,i){i.status==200&&($("#edit_setting_form").html(n),initializeInputs("#edit_setting_form"),$("#edit_setting_modal").modal("show"))},error:function(){notify("An Error occured during sending a request","danger",5)}})});$(document).on("submit","form#edit_setting_form",function(n){n.preventDefault();let t=new FormData(document.querySelector("form#edit_setting_form"));$.ajax({url:UpdateSettingURL,method:"post",data:t,processData:!1,contentType:!1,success:function(n,t,i){i.status==200&&(notify("Successfully updated","success",5),setTimeout(function(){document.location.reload(!1)},2e3));$("form#edit_setting_form").html(n);initializeInputs("form#edit_setting_form")},error:function(){notify("An Error occured during sending a request","danger",5)}})});var canPing=function(){let n=null;return function(){if(n==null)return n=new Date,!0;let t=new Date,i=t.getTime()-n.getTime();return i>=6e4?(n=t,!0):!1}}();$.sessionTimeout({message:"Your session will be expired in a minute.",ignoreUserActivity:!1,keepAlive:!1,logoutUrl:"/Auth/Logout",redirUrl:"/Auth/Login",countdownBar:!0,onStart:function(n){canPing()&&$.ajax({url:"/Auth/Ping",method:"post",success:function(t,i,r){r.status==200&&(n.redirAfter=t.expirationSeconds*1e3,n.warnAfter=t.expirationSeconds>60?(t.expirationSeconds-60)*1e3:0)},error:function(n){n.status==401?notify("Pinging failed","danger",5):notify("An error occured during pinging","danger",5)}})}});$(document).ready(function(){initializeStep()});$(document).on("submit","form#add_user_to_plan_new",function(n){n.preventDefault();let t=new FormData(document.querySelector("form#add_user_to_plan_new"));t.set("PlanId",GlobalPlanId);$.ajax({url:AddNewUserToPlanURL,method:"post",data:t,processData:!1,contentType:!1,success:function(n,t,i){i.status==201&&(notify("Successfully added","success",5),$("#planning_team_add_modal").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),updatePlanningTeam(),refreshStepForm(!0));i.status==400&&notify("An Error occured during sending a request","danger",5);$("form#add_user_to_plan_new").html(n);$("form#add_user_to_plan_new").find(".m-select2").select2();$.validator.unobtrusive.parse("form#add_user_to_plan_new")},error:function(){notify("An Error occured during sending a request","danger",5)}})});$(document).on("submit","form#add_user_to_plan_existing",function(n){n.preventDefault();let t=new FormData(document.querySelector("form#add_user_to_plan_existing"));t.set("PlanId",GlobalPlanId);$.ajax({url:AddExistingUserToPlanURL,method:"post",data:t,processData:!1,contentType:!1,success:function(n,t,i){i.status==201&&(notify("Successfully added","success",5),$("#planning_team_add_modal").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),updatePlanningTeam(),refreshStepForm(!0));i.status==400&&notify("An Error occured during sending a request","danger",5);$("form#add_user_to_plan_existing").html(n);$("form#add_user_to_plan_existing").find(".m-select2").select2();$.validator.unobtrusive.parse("form#add_user_to_plan_existing")},error:function(){notify("An Error occured during sending a request","danger",5)}})});$(document).on("click",".remove-user-from-plan",function(n){n.preventDefault();let t=$(this).data("id");deleteConfirm().then(n=>{n&&$.ajax({url:RemoveUserFromPlanURL,method:"post",data:{userId:t,planId:GlobalPlanId},success:function(n,t,i){i.status==400&&notify("An Error occured during sending a request","danger",5);n.result?(notify("Successfully deleted","success",5),updatePlanningTeam(),refreshStepForm(!0)):notify("Removing the user failed","danger",5)},error:function(){notify("An Error occured during sending a request","danger",5)}})})});$(document).on("click","button#step_form_save_button",function(){$("#step_form").valid()&&updateStep(!1)});$(document).on("click","button#step_form_submit_button",function(){$("#step_form").valid()&&submitConfirm().then(function(n){n&&updateStep(!0)})});$(document).ready(function(){$(document).on("show.bs.modal","#edit_steptasks_modal",function(n){let t=$(n.relatedTarget).data("step");console.log("called bs modal show");$(this).find('input[name$="Step"]').val(t)});$(document).on("submit","form#add_responsible_user_to_step_new",function(n){if(n.preventDefault(),$(this).valid()){let t=parseInt($("input#step_tasks_count").val()),i=$(this).find('input[name$="Email"]').val(),r=$(this).find('input[name$="FirstName"]').val(),u=$(this).find('input[name$="LastName"]').val(),f=$(this).find('input[name$="Step"]').val(),e=`<a class="m-list-badge__item m-list-badge__item--default list-item">
                                <input type="hidden" name="StepTaskAnswers.Answer.StepTaskAnswers[${t}].Email" value="${i}" />
                                <input type="hidden" name="StepTaskAnswers.Answer.StepTaskAnswers[${t}].FirstName" value="${r}" />
                                <input type="hidden" name="StepTaskAnswers.Answer.StepTaskAnswers[${t}].LastName" value="${u}" />
                                <input type="hidden" name="StepTaskAnswers.Answer.StepTaskAnswers[${t}].Step" value="${f}" />
                                <input type="hidden" name="StepTaskAnswers.Answer.StepTaskAnswers.Index" value="${t}" />
                                ${r} ${u} (${i})
                                <span class="fa fa-close list-item-delete"></span>
                            </a>`;$("#step_tasks_list_"+f).append(e);$("input#step_tasks_count").val(t+1);$("#edit_steptasks_modal").modal("hide");$("body").removeClass("modal-open");$(".modal-backdrop").remove()}});$(document).on("submit","form#add_responsible_user_to_step_existing",function(n){if(n.preventDefault(),$(this).valid()){let t=parseInt($("input#step_tasks_count").val()),i=$(this).find('select[name$="Id"]').val(),u=$(this).find('select[name$="Id"] option[value="'+i+'"]').text(),r=$(this).find('input[name$="Step"]').val(),f=`<a class="m-list-badge__item m-list-badge__item--default list-item">
                                <input type="hidden" name="StepTaskAnswers.Answer.StepTaskAnswers[${t}].UserToPlanId" value="${i}" />
                                <input type="hidden" name="StepTaskAnswers.Answer.StepTaskAnswers[${t}].Step" value="${r}" />
                                <input type="hidden" name="StepTaskAnswers.Answer.StepTaskAnswers.Index" value="${t}" />
                                ${u}
                                <span class="fa fa-close list-item-delete"></span>
                            </a>`;$("#step_tasks_list_"+r).append(f);$("input#step_tasks_count").val(t+1);$("#edit_steptasks_modal").modal("hide");$("body").removeClass("modal-open");$(".modal-backdrop").remove()}})});$(document).on("hidden.bs.modal",function(n){var t=$(n.target);t.find(".m-input").each(function(n,t){$(t).val("")});t.find("select.m-select2").each(function(n,t){$(t).select2("val","");$(t).select2("close");$(t).trigger("change")});t.find(".m-index").val("");t.find(".field-validation-error").text("")});$(document).on("click",".step-complete-checkbox",function(n){n.preventDefault();let t=n.target;if($(t).prop("checked")){let i=$(t).data("planid"),r=$(t).data("step");completeStep(i,r,function(){setTimeout(function(){location.reload()},1e3)})}});$(document).on("click","button#step_form_complete",function(n){n.preventDefault();let t=new FormData(document.querySelector("form#step_form")),i=t.get("PlanId"),r=t.get("Step");completeStep(i,r,function(){setTimeout(function(){location.reload()},1e3)})});